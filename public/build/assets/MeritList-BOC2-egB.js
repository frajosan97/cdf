import{r as c,R as P,j as e,H as Q,b as L}from"./app-DPcbxTOd.js";import{A as X,B as E}from"./AuthenticatedLayout-BDpcHxs5.js";import{A as Y,P as Z,S as ee,a as te}from"./PdfViewer-CrsRsFkW.js";import{S as _}from"./react-select.esm-CRioQM6k.js";import{P as v,C as se,B as $}from"./Container-B_mnjrQ9.js";import{R as C}from"./Row-DBg6b2YQ.js";import{C as b}from"./Col-CHXxh1EV.js";import{G as re}from"./geo-alt-BrxPZ3yo.js";import{F as ae}from"./Form-qlW_KRhp.js";import{D as ie,F as le}from"./file-earmark-pdf-MmZX-Oyb.js";import{A as O}from"./Alert-BKKqrQ7V.js";import{C as T}from"./Card-CydrCQAQ.js";import"./ApplicationLogo-U8AXn7eS.js";import"./createLucideIcon-B7bc1YDp.js";import"./Nav-CMn0ohHf.js";import"./Fade-im2yVPtn.js";import"./CloseButton-DcqUzm3a.js";import"./warning-DlyZssLe.js";import"./InputGroupContext-BOS9fLeI.js";var ne=["color","size","title","className"];function F(){return F=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var l in i)({}).hasOwnProperty.call(i,l)&&(s[l]=i[l])}return s},F.apply(null,arguments)}function oe(s,n){if(s==null)return{};var i,l,y=ce(s,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(s);for(l=0;l<p.length;l++)i=p[l],n.indexOf(i)===-1&&{}.propertyIsEnumerable.call(s,i)&&(y[i]=s[i])}return y}function ce(s,n){if(s==null)return{};var i={};for(var l in s)if({}.hasOwnProperty.call(s,l)){if(n.indexOf(l)!==-1)continue;i[l]=s[l]}return i}var M=c.forwardRef(function(s,n){var i=s.color,l=i===void 0?"currentColor":i,y=s.size,p=y===void 0?"1em":y,j=s.title,f=j===void 0?null:j,w=s.className,a=w===void 0?"":w,z=oe(s,ne);return P.createElement("svg",F({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:p,height:p,fill:l,className:["bi","bi-person-badge",a].filter(Boolean).join(" ")},z),f?P.createElement("title",null,f):null,P.createElement("path",{d:"M6.5 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0"}),P.createElement("path",{d:"M4.5 0A2.5 2.5 0 0 0 2 2.5V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2.5A2.5 2.5 0 0 0 11.5 0zM3 2.5A1.5 1.5 0 0 1 4.5 1h7A1.5 1.5 0 0 1 13 2.5v10.795a4.2 4.2 0 0 0-.776-.492C11.392 12.387 10.063 12 8 12s-3.392.387-4.224.803a4.2 4.2 0 0 0-.776.492z"}))});M.propTypes={color:v.string,size:v.oneOfType([v.string,v.number]),title:v.string,className:v.string};const Ee=({data:s,pdf:n,wards:i,locations:l,filters:y,stats:p})=>{const j=new URLSearchParams(window.location.search),f=j.get("type")||s?.type||"constituency",w=j.get("id")||s?.id||"",[a,z]=c.useState(()=>({value:f,label:f==="constituency"?"Constituency Wide":U(f)})),[u,N]=c.useState(()=>{if(w&&f!=="constituency"){const r=(f==="ward"?i:l)?.find(o=>o.id.toString()===w);if(r)return{value:r.id.toString(),label:r.name}}return null}),[x,d]=c.useState(!1),[h,S]=c.useState(n),[W,g]=c.useState(!0),[A,m]=c.useState(null),R=c.useMemo(()=>i?.map(t=>({value:t.id.toString(),label:t.name}))||[],[i]),k=c.useMemo(()=>l?.map(t=>({value:t.id.toString(),label:t.name,ward_id:t.ward_id}))||[],[l]),B=c.useMemo(()=>a?.value==="ward"?R:a?.value==="location"?k:[],[a,R,k]);c.useEffect(()=>{if(s?.type&&s?.id&&s?.type!=="constituency"){const r=(s.type==="ward"?i:l)?.find(o=>o.id.toString()===s.id);r&&N({value:r.id.toString(),label:r.name})}},[s,i,l]),c.useEffect(()=>{n&&(S(n),g(!0),m(null),d(!1))},[n]);function U(t){return t.charAt(0).toUpperCase()+t.slice(1)}const G=()=>a?.value==="constituency"?"Constituency Wide":u?u.label:"Select...",H=t=>{if(!t)return;z(t),N(null),d(!0),g(!1),m(null);const r=new URL(window.location);r.searchParams.set("type",t.value),r.searchParams.delete("id"),window.history.pushState({},"",r),t.value==="constituency"?L.get(route("reports.merit.preview",{type:"constituency"}),{},{preserveState:!0,preserveScroll:!0,onSuccess:o=>{S(o.props.pdf),g(!0),d(!1)},onError:o=>{m(o.message||"Failed to generate merit list"),d(!1)}}):d(!1)},V=t=>{if(!t){N(null),S(null),g(!1);const o=new URL(window.location);o.searchParams.delete("id"),window.history.pushState({},"",o);return}N(t),d(!0),g(!1),m(null);const r=new URL(window.location);r.searchParams.set("type",a.value),r.searchParams.set("id",t.value),window.history.pushState({},"",r),L.get(route("reports.merit.preview",{type:a.value,id:t.value}),{},{preserveState:!0,preserveScroll:!0,onSuccess:o=>{S(o.props.pdf),g(!0),d(!1)},onError:o=>{m(o.message||"Failed to generate merit list"),d(!1)}})},I=()=>{if(!h)return;const t=u?u.label.replace(/\s+/g,"-").toLowerCase():"constituency",r=document.createElement("a");r.href=`data:application/pdf;base64,${h}`,r.download=`merit-list-${t}-${new Date().toISOString().split("T")[0]}.pdf`,r.click()},q=()=>{if(!h)return;const t=window.open("","_blank");if(!t){m("Popup blocked. Please allow popups for this site.");return}t.document.write(`
            <html>
                <head>
                    <title>Merit List - ${u?.label||"Constituency Wide"}</title>
                    <style>
                        body, html { margin: 0; padding: 0; height: 100%; }
                        embed { width: 100%; height: 100%; }
                    </style>
                </head>
                <body>
                    <embed src="data:application/pdf;base64,${h}" type="application/pdf" width="100%" height="100%" />
                </body>
            </html>
        `),t.document.close(),setTimeout(()=>{try{t.focus(),t.print()}catch{m("Unable to print. Please try downloading first.")}},1e3)},J=()=>{if(!a){m("Please select a report type first");return}d(!0),m(null);const t={type:a.value};u&&(t.id=u.value),L.get(route("reports.merit.preview",t),{},{preserveState:!0,preserveScroll:!0,onSuccess:r=>{S(r.props.pdf),g(!0),d(!1)},onError:r=>{m(r.message||"Failed to refresh"),d(!1)}})},K=[{value:"constituency",label:"Constituency Wide"},{value:"ward",label:"Ward"},{value:"location",label:"Location"}],D={control:(t,r)=>({...t,minHeight:"45px",border:r.isFocused?"2px solid #0d6efd":"1px solid #dee2e6",boxShadow:"none","&:hover":{borderColor:"#0d6efd"}}),option:(t,r)=>({...t,backgroundColor:r.isSelected?"#0d6efd":r.isFocused?"#e7f1ff":"white",color:r.isSelected?"white":"black",cursor:"pointer",padding:"10px 12px"}),menu:t=>({...t,zIndex:9999}),placeholder:t=>({...t,color:"#6c757d"}),singleValue:t=>({...t,fontWeight:"500"})};return e.jsxs(X,{children:[e.jsx(Q,{title:s?.title||"Merit List"}),e.jsxs(se,{fluid:!0,children:[e.jsxs(C,{className:"mb-4 align-items-center",children:[e.jsxs(b,{children:[e.jsx("h3",{className:"mb-0 text-capitalize",children:s?.title||"Merit List"}),e.jsx("small",{className:"text-muted",children:"Generate and view merit lists for approved applicants"}),s?.generated_at&&e.jsxs("small",{className:"text-muted ms-3",children:["Last generated: ",s.generated_at]})]}),e.jsxs(b,{xs:"auto",children:[e.jsxs(E,{bg:"info",className:"p-2 me-2",children:[e.jsx(M,{className:"me-1",size:14}),G()]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{bg:"success",className:"p-2 me-2",children:[e.jsx(M,{className:"me-1",size:14}),p.total_approved||0," Approved"]}),e.jsxs(E,{bg:"secondary",className:"p-2",children:[e.jsx(re,{className:"me-1",size:14}),s?.statistics?.total_applicants||0," ","Total"]})]})]})]}),e.jsxs(C,{className:"mb-4 g-3",children:[e.jsxs(b,{md:6,lg:7,children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("div",{style:{width:"200px"},children:e.jsx(_,{options:K,value:a,onChange:H,isDisabled:x,placeholder:"Report type...",className:"react-select-container",classNamePrefix:"react-select",styles:D,isClearable:!1,isSearchable:!1})}),e.jsx("div",{style:{flex:1},children:e.jsx(_,{options:B,value:u,onChange:V,isDisabled:x||!a||a.value==="constituency",placeholder:a?.value==="constituency"?"Constituency wide":`Search ${a?.value}...`,className:"react-select-container",classNamePrefix:"react-select",styles:D,isClearable:!0,isSearchable:!0,loadingMessage:()=>`Loading ${a?.value}s...`,noOptionsMessage:()=>`No ${a?.value}s found`})})]}),e.jsx(ae.Text,{className:"text-muted",children:a?.value==="constituency"?"Constituency wide report generates automatically":`Select a ${a?.value} to generate its merit list`})]}),e.jsx(b,{md:6,lg:5,children:e.jsxs("div",{className:"d-flex gap-2 justify-content-md-end",children:[e.jsxs($,{variant:"outline-secondary",size:"sm",onClick:J,disabled:x||!a,className:"d-flex align-items-center gap-2",children:[e.jsx(Y,{size:16,className:x?"spin":""}),"Refresh"]}),e.jsxs($,{variant:"primary",size:"sm",onClick:q,disabled:!h||x,className:"d-flex align-items-center gap-2",children:[e.jsx(Z,{size:16}),"Print"]}),e.jsxs($,{variant:"success",size:"sm",onClick:I,disabled:!h||x,className:"d-flex align-items-center gap-2",children:[e.jsx(ie,{size:16}),"Download PDF"]})]})})]}),A&&e.jsx(C,{className:"mb-4",children:e.jsx(b,{children:e.jsxs(O,{variant:"danger",onClose:()=>m(null),dismissible:!0,className:"mb-0",children:[e.jsx(O.Heading,{className:"fs-6",children:"Error"}),e.jsx("p",{className:"mb-0 small",children:A})]})})}),e.jsx(C,{children:e.jsx(b,{children:e.jsx(T,{className:"border-0 shadow-sm",children:e.jsx(T.Body,{className:"p-0",style:{height:"calc(100vh - 350px)"},children:x?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[e.jsx(ee,{animation:"border",variant:"primary",style:{width:"3rem",height:"3rem"}}),e.jsx("p",{className:"mt-3 text-muted",children:"Generating merit list..."}),e.jsx("small",{className:"text-muted",children:"This may take a few moments"})]}):W&&h?e.jsx(te,{pdfBase64:h,title:`Merit List - ${u?.label||"Constituency Wide"}`}):e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[e.jsx(le,{size:64,className:"text-muted mb-3 opacity-50"}),e.jsx("h5",{className:"text-muted mb-2",children:"No PDF Available"}),e.jsx("p",{className:"text-muted small text-center px-4",children:a?a.value!=="constituency"&&!u?`Select a ${a.value} to generate its merit list`:"Click refresh to generate the merit list":"Please select a report type to generate a merit list"})]})})})})})]}),e.jsx("style",{children:`
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    .spin {
                        animation: spin 1s linear infinite;
                    }
                `})]})};export{Ee as default};
