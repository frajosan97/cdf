import{r as d,R as w,j as e,H as M,b as y}from"./app-DPcbxTOd.js";import{A as R,B}from"./AuthenticatedLayout-BDpcHxs5.js";import{A as T,P as _,S as H,a as W}from"./PdfViewer-CrsRsFkW.js";import{S as G}from"./react-select.esm-CRioQM6k.js";import{P as p,C as U,B as N}from"./Container-B_mnjrQ9.js";import{R as j}from"./Row-DBg6b2YQ.js";import{C as g}from"./Col-CHXxh1EV.js";import{F as V}from"./Form-qlW_KRhp.js";import{D as q,F as J}from"./file-earmark-pdf-MmZX-Oyb.js";import{A as F}from"./Alert-BKKqrQ7V.js";import{C}from"./Card-CydrCQAQ.js";import"./ApplicationLogo-U8AXn7eS.js";import"./createLucideIcon-B7bc1YDp.js";import"./Nav-CMn0ohHf.js";import"./Fade-im2yVPtn.js";import"./CloseButton-DcqUzm3a.js";import"./warning-DlyZssLe.js";import"./InputGroupContext-BOS9fLeI.js";var K=["color","size","title","className"];function S(){return S=Object.assign?Object.assign.bind():function(a){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var i in s)({}).hasOwnProperty.call(s,i)&&(a[i]=s[i])}return a},S.apply(null,arguments)}function Q(a,l){if(a==null)return{};var s,i,m=X(a,l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);for(i=0;i<n.length;i++)s=n[i],l.indexOf(s)===-1&&{}.propertyIsEnumerable.call(a,s)&&(m[s]=a[s])}return m}function X(a,l){if(a==null)return{};var s={};for(var i in a)if({}.hasOwnProperty.call(a,i)){if(l.indexOf(i)!==-1)continue;s[i]=a[i]}return s}var $=d.forwardRef(function(a,l){var s=a.color,i=s===void 0?"currentColor":s,m=a.size,n=m===void 0?"1em":m,x=a.title,u=x===void 0?null:x,o=a.className,c=o===void 0?"":o,v=Q(a,K);return w.createElement("svg",S({ref:l,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:n,height:n,fill:i,className:["bi","bi-building",c].filter(Boolean).join(" ")},v),u?w.createElement("title",null,u):null,w.createElement("path",{d:"M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"}),w.createElement("path",{d:"M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3z"}))});$.propTypes={color:p.string,size:p.oneOfType([p.string,p.number]),title:p.string,className:p.string};const ge=({data:a,pdf:l,institutions:s})=>{const m=new URLSearchParams(window.location.search).get("institution_id")||"all",[n,x]=d.useState(()=>m!=="all"?{value:m,label:s?.find(t=>t.id==m)?.name||"All Institutions"}:{value:"all",label:"All Institutions"}),[u,o]=d.useState(!1),[c,v]=d.useState(l),[E,b]=d.useState(!0),[P,f]=d.useState(null),I=d.useMemo(()=>[{value:"all",label:"All Institutions"},...s?.map(r=>({value:r.id.toString(),label:`${r.name} (${r.code})`,institution:r}))||[]],[s]);d.useEffect(()=>{if(a?.type==="single"&&a?.institutions?.[0]){const t=a.institutions[0];x({value:t.id.toString(),label:`${t.name} (${t.code})`})}},[a]),d.useEffect(()=>{l&&(v(l),b(!0),f(null))},[l]);const D=t=>{if(!t)return;x(t),o(!0),b(!1),f(null);const r=t.value;r==="all"?y.get(route("reports.forwarding.letter"),{},{preserveState:!0,preserveScroll:!0,onSuccess:h=>{v(h.props.pdf),b(!0),o(!1)},onError:h=>{f(h.message||"Failed to load forwarding letter"),o(!1)}}):y.get(route("reports.institution.forwarding.letter",r),{},{preserveState:!0,preserveScroll:!0,onSuccess:h=>{v(h.props.pdf),b(!0),o(!1)},onError:h=>{f(h.message||"Failed to load forwarding letter"),o(!1)}})},k=()=>{if(c){const t=n?.value==="all"?"all-institutions":s?.find(h=>h.id.toString()===n.value)?.name?.replace(/\s+/g,"-").toLowerCase()||"forwarding-letter",r=document.createElement("a");r.href=`data:application/pdf;base64,${c}`,r.download=`forwarding-letter-${t}-${new Date().toISOString().split("T")[0]}.pdf`,r.click()}},A=()=>{if(c){const t=window.open("","_blank");if(!t){f("Popup blocked. Please allow popups for this site.");return}t.document.write(`
                <html>
                    <head>
                        <title>Forwarding Letter - ${n?.label||"NG-CDF"}</title>
                        <style>
                            body, html { margin: 0; padding: 0; height: 100%; }
                            embed { width: 100%; height: 100%; }
                        </style>
                    </head>
                    <body>
                        <embed src="data:application/pdf;base64,${c}" type="application/pdf" width="100%" height="100%" />
                    </body>
                </html>
            `),t.document.close(),setTimeout(()=>{try{t.focus(),t.print()}catch{f("Unable to print. Please try downloading first.")}},1e3)}},O=()=>{o(!0),f(null),y.reload({onSuccess:()=>{o(!1)},onError:t=>{f(t.message||"Failed to refresh"),o(!1)}})},z=d.useMemo(()=>{if(n?.value==="all")return"All Institutions";const t=s?.find(r=>r.id.toString()===n?.value);return t?`${t.name} (${t.code})`:"Select Institution"},[n,s]),L={control:(t,r)=>({...t,minHeight:"45px",border:r.isFocused?"2px solid #0d6efd":"1px solid #dee2e6",boxShadow:"none","&:hover":{borderColor:"#0d6efd"}}),option:(t,r)=>({...t,backgroundColor:r.isSelected?"#0d6efd":r.isFocused?"#e7f1ff":"white",color:r.isSelected?"white":"black",cursor:"pointer",padding:"10px 12px"}),menu:t=>({...t,zIndex:9999}),placeholder:t=>({...t,color:"#6c757d"}),singleValue:t=>({...t,fontWeight:"500"})};return e.jsxs(R,{children:[e.jsx(M,{title:"Forwarding Letter"}),e.jsxs(U,{fluid:!0,children:[e.jsxs(j,{className:"mb-4 align-items-center",children:[e.jsxs(g,{children:[e.jsx("h3",{className:"mb-0",children:"Forwarding Letter"}),e.jsx("small",{className:"text-muted",children:"Generate and manage bursary forwarding letters"})]}),e.jsx(g,{xs:"auto",children:e.jsxs(B,{bg:"info",className:"p-2",children:[e.jsx($,{className:"me-1",size:14}),z]})})]}),e.jsxs(j,{className:"mb-4 g-3",children:[e.jsxs(g,{md:6,lg:7,children:[e.jsx(G,{options:I,value:n,onChange:D,isDisabled:u,placeholder:"Search institution...",className:"react-select-container",classNamePrefix:"react-select",styles:L,isClearable:!1,isSearchable:!0,loadingMessage:()=>"Loading institutions...",noOptionsMessage:()=>"No institutions found"}),e.jsx(V.Text,{className:"text-muted",children:"Select an institution to generate its forwarding letter"})]}),e.jsx(g,{md:6,lg:5,children:e.jsxs("div",{className:"d-flex gap-2 justify-content-md-end",children:[e.jsxs(N,{variant:"outline-secondary",size:"sm",onClick:O,disabled:u,className:"d-flex align-items-center gap-2",children:[e.jsx(T,{size:16,className:u?"spin":""}),"Refresh"]}),e.jsxs(N,{variant:"primary",size:"sm",onClick:A,disabled:!c||u,className:"d-flex align-items-center gap-2",children:[e.jsx(_,{size:16}),"Print"]}),e.jsxs(N,{variant:"success",size:"sm",onClick:k,disabled:!c||u,className:"d-flex align-items-center gap-2",children:[e.jsx(q,{size:16}),"Download PDF"]})]})})]}),P&&e.jsx(j,{className:"mb-4",children:e.jsx(g,{children:e.jsxs(F,{variant:"danger",onClose:()=>f(null),dismissible:!0,className:"mb-0",children:[e.jsx(F.Heading,{className:"fs-6",children:"Error"}),e.jsx("p",{className:"mb-0 small",children:P})]})})}),e.jsx(j,{children:e.jsx(g,{children:e.jsx(C,{className:"border-0 shadow-sm",children:e.jsx(C.Body,{className:"p-0",style:{height:"calc(100vh - 350px)"},children:u?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[e.jsx(H,{animation:"border",variant:"primary",style:{width:"3rem",height:"3rem"}}),e.jsx("p",{className:"mt-3 text-muted",children:"Generating forwarding letter..."}),e.jsx("small",{className:"text-muted",children:"This may take a few moments"})]}):E&&c?e.jsx(W,{pdfBase64:c,title:`Forwarding Letter - ${z}`}):e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[e.jsx(J,{size:64,className:"text-muted mb-3 opacity-50"}),e.jsx("h5",{className:"text-muted mb-2",children:"No PDF Available"}),e.jsx("p",{className:"text-muted small text-center px-4",children:n?.value==="all"?"Select 'All Institutions' to generate a combined forwarding letter":"Please select an institution to generate its forwarding letter"})]})})})})})]}),e.jsx("style",{children:`
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    .spin {
                        animation: spin 1s linear infinite;
                    }
                `})]})};export{ge as default};
