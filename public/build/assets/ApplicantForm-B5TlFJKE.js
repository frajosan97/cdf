import{c as ae,r as h,j as e,H as ie,L as re,a as oe}from"./app-DPcbxTOd.js";import{A as de,y as L}from"./AuthenticatedLayout-BDpcHxs5.js";import{u as le,S as ce}from"./sweetalert2.esm.all-gqP-rt2y.js";import{S as v}from"./react-select.esm-CRioQM6k.js";import{C as me,B as q}from"./Container-B_mnjrQ9.js";import{R as f}from"./Row-DBg6b2YQ.js";import{C as u}from"./Col-CHXxh1EV.js";import{C as A}from"./Card-CydrCQAQ.js";import{F as s}from"./Form-qlW_KRhp.js";import"./ApplicationLogo-U8AXn7eS.js";import"./createLucideIcon-B7bc1YDp.js";import"./Nav-CMn0ohHf.js";import"./Fade-im2yVPtn.js";import"./CloseButton-DcqUzm3a.js";import"./warning-DlyZssLe.js";import"./InputGroupContext-BOS9fLeI.js";function F(l){for(var p=1;p<arguments.length;p++){var b=arguments[p];for(var j in b)l[j]=b[j]}return l}var ue={read:function(l){return l[0]==='"'&&(l=l.slice(1,-1)),l.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(l){return encodeURIComponent(l).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function B(l,p){function b(r,d,o){if(!(typeof document>"u")){o=F({},p,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var x="";for(var a in o)o[a]&&(x+="; "+a,o[a]!==!0&&(x+="="+o[a].split(";")[0]));return document.cookie=r+"="+l.write(d,r)+x}}function j(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var d=document.cookie?document.cookie.split("; "):[],o={},x=0;x<d.length;x++){var a=d[x].split("="),_=a.slice(1).join("=");try{var w=decodeURIComponent(a[0]);if(o[w]=l.read(_,w),r===w)break}catch{}}return r?o[r]:o}}return Object.create({set:b,get:j,remove:function(r,d){b(r,"",F({},d,{expires:-1}))},withAttributes:function(r){return B(this.converter,F({},this.attributes,r))},withConverter:function(r){return B(F({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(p)},converter:{value:Object.freeze(l)}})}var k=B(ue,{path:"/"});const Fe=()=>{const{institutions:l=[],wards:p=[],types:b=[],parentStatuses:j=[],applicant:r=null}=ae().props,d=!!r,[o,x]=h.useState(!1),[a,_]=h.useState({}),{showErrorToast:w}=le(),E=d?r.ward_id:parseInt(k.get("selectedWardId")),G=d?r.location_id:parseInt(k.get("selectedLocationId")),[t,C]=h.useState({ward_id:E||"",location_id:G||"",institution_id:r?.institution_id||"",student_name:r?.student_name||"",admission_number:r?.admission_number||"",type:r?.type||"",parent_status:r?.parent_status||"",parent_phone_number:r?.parent_phone_number||"",parent_id_number:r?.parent_id_number||"",amount:r?.amount||"",decision:r?.decision||"",decision_reason:r?.decision_reason||""}),H=h.useMemo(()=>t.ward_id&&p.find(i=>i.id===t.ward_id)?.name||"",[t.ward_id,p]),V=h.useMemo(()=>t.ward_id?p.find(i=>i.id===t.ward_id)?.locations||[]:[],[t.ward_id,p]),Y=h.useMemo(()=>!t.location_id||!t.ward_id?"":p.find(c=>c.id===t.ward_id)?.locations?.find(c=>c.id===t.location_id)?.name||"",[t.location_id,t.ward_id,p]),[y,K]=h.useState(null),J=h.useMemo(()=>[...new Set(l.map(i=>i.category))].sort().map(i=>({value:i,label:i})),[l]),Q=h.useMemo(()=>y?l.filter(n=>n.category===y.value):l,[l,y]),P=h.useMemo(()=>t.institution_id?l.find(n=>n.id===parseInt(t.institution_id)):null,[t.institution_id,l]),[U,$]=h.useState(!d&&(!E||!G)),W=(n,i)=>{d||(n&&k.set("selectedWardId",n,{expires:7}),i&&k.set("selectedLocationId",i,{expires:7}))},X=h.useMemo(()=>t.ward_id&&t.location_id&&t.institution_id&&t.student_name?.trim()&&t.admission_number?.trim()&&t.type&&t.parent_status&&t.parent_phone_number?.trim()&&t.parent_id_number?.trim(),[t]),S=n=>{const{name:i,value:c,type:m,checked:D}=n.target;C(I=>({...I,[i]:m==="checkbox"?D:c})),a[i]&&_(I=>({...I,[i]:null}))},N=(n,i)=>{const c=n?n.value:"";i==="ward_id"?(W(c,""),C(m=>({...m,ward_id:c,location_id:""}))):i==="location_id"?(W(t.ward_id,c),C(m=>({...m,location_id:c}))):C(m=>({...m,[i]:c})),a[i]&&_(m=>({...m,[i]:null}))},Z=n=>{const{name:i,value:c}=n.target;(c===""||/^\d*\.?\d*$/.test(c))&&(C(m=>({...m,[i]:c})),a[i]&&_(m=>({...m,[i]:null})))},ee=()=>{const n={};return t.ward_id||(n.ward_id="Ward is required"),t.location_id||(n.location_id="Location is required"),t.institution_id||(n.institution_id="Institution is required"),t.student_name?.trim()||(n.student_name="Student name is required"),t.admission_number?.trim()||(n.admission_number="Admission number is required"),t.type||(n.type="Applicant type is required"),t.parent_status||(n.parent_status="Parent status is required"),t.parent_phone_number?.trim()?/^[0-9+\-\s]{10,15}$/.test(t.parent_phone_number.replace(/\s/g,""))||(n.parent_phone_number="Invalid phone number format"):n.parent_phone_number="Parent phone number is required",t.parent_id_number?.trim()||(n.parent_id_number="Parent ID number is required"),t.amount&&parseFloat(t.amount)<=0&&(n.amount="Amount must be greater than 0"),_(n),Object.keys(n).length===0},ne=async n=>{if(n.preventDefault(),!ee()){L.error("Please fix the validation errors");return}const i=d?"update":"create",c=d?"update":"create";try{if(!(await ce.fire({title:`${d?"Update":"Create"} Applicant`,text:`Are you sure you want to ${c} this applicant?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${c}`,cancelButtonText:"Cancel"})).isConfirmed)return;x(!0);const D=d?route("applicant.update",r.id):route("applicant.store");(await oe({method:d?"put":"post",url:D,data:{ward_id:t.ward_id,location_id:t.location_id,institution_id:t.institution_id,student_name:t.student_name.trim(),admission_number:t.admission_number.trim(),type:t.type,parent_status:t.parent_status,parent_phone_number:t.parent_phone_number.trim(),parent_id_number:t.parent_id_number.trim(),amount:t.amount||null,decision:t.decision,decision_reason:t.decision_reason}})).data?.success&&(L.success(`Applicant ${c}d successfully`),window.location.href=route("applicant.index"))}catch(m){m.response?.status===422?(_(m.response.data.errors||{}),L.error("Validation failed")):w(m,`Failed to ${i} applicant`)}finally{x(!1)}},te=()=>{$(!0)},se=()=>{t.ward_id&&t.location_id?($(!1),W(t.ward_id,t.location_id)):L.error("Please select both ward and location")},O=p.map(n=>({value:n.id,label:n.name})),M=V.map(n=>({value:n.id,label:n.name})),R=Q.map(n=>({value:n.id,label:`${n.name} (${n.category})`})),T=b.map(n=>({value:n,label:n})),z=j.map(n=>({value:n,label:n})),g={control:(n,i)=>({...n,borderColor:i.isFocused?"#86b7fe":"#dee2e6",boxShadow:i.isFocused?"0 0 0 0.25rem rgba(13, 110, 253, 0.25)":null,"&:hover":{borderColor:"#86b7fe"}}),menu:n=>({...n,zIndex:100})};return e.jsxs(de,{children:[e.jsx(ie,{title:`${d?"Edit":"Create"} Applicant`}),e.jsxs(me,{fluid:!0,children:[e.jsx(f,{className:"mb-4 align-items-center",children:e.jsx(u,{children:e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"h2 mb-0 fw-bold",children:[d?"Edit":"Create New"," ","Applicant"]}),e.jsx("p",{className:"text-muted mt-1 mb-0",children:d?"Update scholarship applicant information in the system":"Add a new scholarship applicant to the system"})]})})})}),U&&e.jsx(f,{className:"mb-4",children:e.jsx(u,{children:e.jsx(A,{className:"border-0 shadow-sm bg-light",children:e.jsxs(A.Body,{children:[e.jsxs("h5",{className:"fw-bold mb-3",children:[e.jsx("i",{className:"bi bi-geo-alt-fill me-2 text-primary"}),"Select Working Area"]}),e.jsxs(f,{children:[e.jsx(u,{md:5,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Ward"}),e.jsx(v,{name:"ward_id",value:O.find(n=>n.value===t.ward_id),onChange:n=>N(n,"ward_id"),options:O,isDisabled:o,placeholder:"Select ward",styles:g,isClearable:!0}),a.ward_id&&e.jsx("div",{className:"text-danger small mt-1",children:a.ward_id})]})}),e.jsx(u,{md:5,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Location"}),e.jsx(v,{name:"location_id",value:M.find(n=>n.value===t.location_id),onChange:n=>N(n,"location_id"),options:M,isDisabled:o||!t.ward_id,placeholder:"Select location",styles:g,isClearable:!0}),a.location_id&&e.jsx("div",{className:"text-danger small mt-1",children:a.location_id})]})}),e.jsx(u,{md:2,children:e.jsxs(q,{variant:"primary",onClick:se,className:"w-100 mt-4",disabled:!t.ward_id||!t.location_id,children:[e.jsx("i",{className:"bi bi-check-lg me-2"}),"Continue"]})})]}),!d&&e.jsxs("p",{className:"text-muted small mt-2 mb-0",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Your selection will be saved for future use."]})]})})})}),!U&&e.jsx(f,{children:e.jsx(u,{children:e.jsx(A,{className:"border-0 shadow-sm",children:e.jsxs(A.Body,{className:"p-4",children:[e.jsxs("div",{className:"mb-4 d-flex justify-content-between align-items-center bg-light p-3 rounded",children:[e.jsxs("div",{className:"d-flex gap-4",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Ward"}),e.jsx("strong",{className:"fs-5",children:H})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Location"}),e.jsx("strong",{className:"fs-5",children:Y})]})]}),!d&&e.jsxs(q,{variant:"outline-secondary",size:"sm",onClick:te,children:[e.jsx("i",{className:"bi bi-pencil-square me-2"}),"Change"]})]}),e.jsxs(s,{onSubmit:ne,children:[e.jsxs("h5",{className:"fw-bold mb-3 pb-2 border-bottom",children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),"Personal Information"]}),e.jsxs(f,{children:[e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"fw-semibold",children:"Institution Category"}),e.jsx(v,{value:y,onChange:K,options:J,isDisabled:o,placeholder:"All Categories",styles:g,isClearable:!0})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Institution"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(v,{name:"institution_id",value:R.find(n=>n.value===t.institution_id),onChange:n=>N(n,"institution_id"),options:R,isDisabled:o,placeholder:"Select institution",styles:g,isClearable:!0}),a.institution_id&&e.jsx("div",{className:"text-danger small mt-1",children:a.institution_id}),P&&e.jsxs(s.Text,{className:"text-muted",children:["Category:"," ",P.category]})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Student Name"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(s.Control,{type:"text",name:"student_name",value:t.student_name,onChange:S,placeholder:"Enter student full name",disabled:o,isInvalid:!!a.student_name}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.student_name})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Admission Number"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(s.Control,{type:"text",name:"admission_number",value:t.admission_number,onChange:S,placeholder:"Enter admission number",disabled:o,isInvalid:!!a.admission_number}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.admission_number})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Applicant Type"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(v,{name:"type",value:T.find(n=>n.value===t.type),onChange:n=>N(n,"type"),options:T,isDisabled:o,placeholder:"Select type",styles:g}),a.type&&e.jsx("div",{className:"text-danger small mt-1",children:a.type})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Amount (KES)"," ",e.jsx("span",{className:"text-muted",children:"(Optional)"})]}),e.jsx(s.Control,{type:"text",name:"amount",value:t.amount,onChange:Z,placeholder:"Enter amount (optional)",disabled:o,isInvalid:!!a.amount}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.amount})]})})]}),e.jsxs("h5",{className:"fw-bold mb-3 mt-4 pb-2 border-bottom",children:[e.jsx("i",{className:"bi bi-people me-2"}),"Parent/Guardian Information"]}),e.jsxs(f,{children:[e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Parent Status"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(v,{name:"parent_status",value:z.find(n=>n.value===t.parent_status),onChange:n=>N(n,"parent_status"),options:z,isDisabled:o,placeholder:"Select parent status",styles:g}),a.parent_status&&e.jsx("div",{className:"text-danger small mt-1",children:a.parent_status})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["Phone Number"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(s.Control,{type:"tel",name:"parent_phone_number",value:t.parent_phone_number,onChange:S,placeholder:"Enter phone number",disabled:o,isInvalid:!!a.parent_phone_number}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.parent_phone_number}),e.jsx(s.Text,{className:"text-muted",children:"Format: 0712345678"})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"fw-semibold",children:["ID Number"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(s.Control,{type:"text",name:"parent_id_number",value:t.parent_id_number,onChange:S,placeholder:"Enter ID number",disabled:o,isInvalid:!!a.parent_id_number}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.parent_id_number})]})})]}),e.jsx(f,{className:"mt-4",children:e.jsx(u,{children:e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsxs(re,{href:route("applicant.index"),className:"btn btn-secondary",children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Cancel"]}),e.jsx(q,{type:"submit",variant:"primary",disabled:!X||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),d?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),d?"Update Applicant":"Create Applicant"]})})]})})})]})]})})})})]})]})};export{Fe as default};
