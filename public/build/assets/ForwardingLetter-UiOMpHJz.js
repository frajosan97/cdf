import{r as m,j as a,R as h,c as V,H as G,b as P}from"./app-BHvGR4js.js";import{A as q,B as J}from"./AuthenticatedLayout-BzUGl44w.js";import{S as K}from"./react-select.esm-D3XGQMiw.js";import{u as Q,c as X,P as d,C as Y,B as z}from"./Container-p98MeQ5k.js";import{R as N}from"./Row-C6NhzJ7b.js";import{C as j}from"./Col-DwigXgel.js";import{F as Z}from"./Form-Q2j9ICbV.js";import{D as ee,F as te}from"./file-earmark-pdf-BbRCM2R6.js";import{A as R}from"./Alert-CWilNkyM.js";import{C as F}from"./Card-pGXOtwt2.js";import"./ApplicationLogo-hP5aVGpV.js";import"./createLucideIcon-DHdMkeD_.js";import"./Nav-DifuSH0a.js";import"./Fade-C5nPZceD.js";import"./CloseButton-DQ3VpcOX.js";import"./warning-CjFOLJzl.js";import"./InputGroupContext-CBrQ1b5Q.js";const L=m.forwardRef(({bsPrefix:e,variant:s,animation:t="border",size:r,as:i="div",className:o,...f},u)=>{e=Q(e,"spinner");const l=`${e}-${t}`;return a.jsx(i,{ref:u,...f,className:X(o,l,r&&`${l}-${r}`,s&&`text-${s}`)})});L.displayName="Spinner";var re=["color","size","title","className"];function $(){return $=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},$.apply(null,arguments)}function ae(e,s){if(e==null)return{};var t,r,i=se(e,s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],s.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function se(e,s){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(s.indexOf(r)!==-1)continue;t[r]=e[r]}return t}var I=m.forwardRef(function(e,s){var t=e.color,r=t===void 0?"currentColor":t,i=e.size,o=i===void 0?"1em":i,f=e.title,u=f===void 0?null:f,l=e.className,b=l===void 0?"":l,p=ae(e,re);return h.createElement("svg",$({ref:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-arrow-repeat",b].filter(Boolean).join(" ")},p),u?h.createElement("title",null,u):null,h.createElement("path",{d:"M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9"}),h.createElement("path",{fillRule:"evenodd",d:"M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z"}))});I.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};var ne=["color","size","title","className"];function O(){return O=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},O.apply(null,arguments)}function le(e,s){if(e==null)return{};var t,r,i=ie(e,s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],s.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function ie(e,s){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(s.indexOf(r)!==-1)continue;t[r]=e[r]}return t}var M=m.forwardRef(function(e,s){var t=e.color,r=t===void 0?"currentColor":t,i=e.size,o=i===void 0?"1em":i,f=e.title,u=f===void 0?null:f,l=e.className,b=l===void 0?"":l,p=le(e,ne);return h.createElement("svg",O({ref:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-building",b].filter(Boolean).join(" ")},p),u?h.createElement("title",null,u):null,h.createElement("path",{d:"M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"}),h.createElement("path",{d:"M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3z"}))});M.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};var oe=["color","size","title","className"];function E(){return E=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},E.apply(null,arguments)}function ce(e,s){if(e==null)return{};var t,r,i=de(e,s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],s.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function de(e,s){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(s.indexOf(r)!==-1)continue;t[r]=e[r]}return t}var _=m.forwardRef(function(e,s){var t=e.color,r=t===void 0?"currentColor":t,i=e.size,o=i===void 0?"1em":i,f=e.title,u=f===void 0?null:f,l=e.className,b=l===void 0?"":l,p=ce(e,oe);return h.createElement("svg",E({ref:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:o,height:o,fill:r,className:["bi","bi-printer",b].filter(Boolean).join(" ")},p),u?h.createElement("title",null,u):null,h.createElement("path",{d:"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"}),h.createElement("path",{d:"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1"}))});_.propTypes={color:d.string,size:d.oneOfType([d.string,d.number]),title:d.string,className:d.string};const ue=({pdfBase64:e,title:s="Document"})=>{const t=m.useRef(null);return m.useEffect(()=>{if(t.current&&e){const r=atob(e),i=new Array(r.length);for(let l=0;l<r.length;l++)i[l]=r.charCodeAt(l);const o=new Uint8Array(i),f=new Blob([o],{type:"application/pdf"}),u=URL.createObjectURL(f);return t.current.src=u,()=>URL.revokeObjectURL(u)}},[e]),a.jsx("iframe",{ref:t,title:s,style:{width:"100%",height:"400px",border:"none"}})},Ee=({data:e,pdf:s,institutions:t,approvedApplicants:r,groupedApplicants:i})=>{const{params:o}=V().props,u=new URLSearchParams(window.location.search).get("institution_id")||"all",[l,b]=m.useState(()=>u!=="all"?{value:u,label:t?.find(n=>n.id==u)?.name||"All Institutions"}:{value:"all",label:"All Institutions"}),[p,x]=m.useState(!1),[w,S]=m.useState(s),[D,y]=m.useState(!0),[C,g]=m.useState(null),k=m.useMemo(()=>[{value:"all",label:"All Institutions"},...t?.map(c=>({value:c.id.toString(),label:`${c.name} (${c.code})`,institution:c}))||[]],[t]);m.useEffect(()=>{if(e?.type==="single"&&e?.institutions?.[0]){const n=e.institutions[0];b({value:n.id.toString(),label:`${n.name} (${n.code})`})}},[e]),m.useEffect(()=>{s&&(S(s),y(!0),g(null))},[s]);const B=n=>{if(!n)return;b(n),x(!0),y(!1),g(null);const c=n.value;c==="all"?P.get(route("reports.forwarding.letter"),{},{preserveState:!0,preserveScroll:!0,onSuccess:v=>{S(v.props.pdf),y(!0),x(!1)},onError:v=>{g(v.message||"Failed to load forwarding letter"),x(!1)}}):P.get(route("reports.institution.forwarding.letter",c),{},{preserveState:!0,preserveScroll:!0,onSuccess:v=>{S(v.props.pdf),y(!0),x(!1)},onError:v=>{g(v.message||"Failed to load forwarding letter"),x(!1)}})},H=()=>{if(w){const n=l?.value==="all"?"all-institutions":t?.find(v=>v.id.toString()===l.value)?.name?.replace(/\s+/g,"-").toLowerCase()||"forwarding-letter",c=document.createElement("a");c.href=`data:application/pdf;base64,${w}`,c.download=`forwarding-letter-${n}-${new Date().toISOString().split("T")[0]}.pdf`,c.click()}},T=()=>{if(w){const n=window.open("","_blank");if(!n){g("Popup blocked. Please allow popups for this site.");return}n.document.write(`
                <html>
                    <head>
                        <title>Forwarding Letter - ${l?.label||"NG-CDF"}</title>
                        <style>
                            body, html { margin: 0; padding: 0; height: 100%; }
                            embed { width: 100%; height: 100%; }
                        </style>
                    </head>
                    <body>
                        <embed src="data:application/pdf;base64,${w}" type="application/pdf" width="100%" height="100%" />
                    </body>
                </html>
            `),n.document.close(),setTimeout(()=>{try{n.focus(),n.print()}catch{g("Unable to print. Please try downloading first.")}},1e3)}},U=()=>{x(!0),g(null),P.reload({onSuccess:()=>{x(!1)},onError:n=>{g(n.message||"Failed to refresh"),x(!1)}})},A=m.useMemo(()=>{if(l?.value==="all")return"All Institutions";const n=t?.find(c=>c.id.toString()===l?.value);return n?`${n.name} (${n.code})`:"Select Institution"},[l,t]),W={control:(n,c)=>({...n,minHeight:"45px",border:c.isFocused?"2px solid #0d6efd":"1px solid #dee2e6",boxShadow:"none","&:hover":{borderColor:"#0d6efd"}}),option:(n,c)=>({...n,backgroundColor:c.isSelected?"#0d6efd":c.isFocused?"#e7f1ff":"white",color:c.isSelected?"white":"black",cursor:"pointer",padding:"10px 12px"}),menu:n=>({...n,zIndex:9999}),placeholder:n=>({...n,color:"#6c757d"}),singleValue:n=>({...n,fontWeight:"500"})};return a.jsxs(q,{children:[a.jsx(G,{title:"Forwarding Letter"}),a.jsxs(Y,{fluid:!0,children:[a.jsxs(N,{className:"mb-4 align-items-center",children:[a.jsxs(j,{children:[a.jsx("h3",{className:"mb-0",children:"Forwarding Letter"}),a.jsx("small",{className:"text-muted",children:"Generate and manage bursary forwarding letters"})]}),a.jsx(j,{xs:"auto",children:a.jsxs(J,{bg:"info",className:"p-2",children:[a.jsx(M,{className:"me-1",size:14}),A]})})]}),a.jsxs(N,{className:"mb-4 g-3",children:[a.jsxs(j,{md:6,lg:7,children:[a.jsx(K,{options:k,value:l,onChange:B,isDisabled:p,placeholder:"Search institution...",className:"react-select-container",classNamePrefix:"react-select",styles:W,isClearable:!1,isSearchable:!0,loadingMessage:()=>"Loading institutions...",noOptionsMessage:()=>"No institutions found"}),a.jsx(Z.Text,{className:"text-muted",children:"Select an institution to generate its forwarding letter"})]}),a.jsx(j,{md:6,lg:5,children:a.jsxs("div",{className:"d-flex gap-2 justify-content-md-end",children:[a.jsxs(z,{variant:"outline-secondary",size:"sm",onClick:U,disabled:p,className:"d-flex align-items-center gap-2",children:[a.jsx(I,{size:16,className:p?"spin":""}),"Refresh"]}),a.jsxs(z,{variant:"primary",size:"sm",onClick:T,disabled:!w||p,className:"d-flex align-items-center gap-2",children:[a.jsx(_,{size:16}),"Print"]}),a.jsxs(z,{variant:"success",size:"sm",onClick:H,disabled:!w||p,className:"d-flex align-items-center gap-2",children:[a.jsx(ee,{size:16}),"Download PDF"]})]})})]}),C&&a.jsx(N,{className:"mb-4",children:a.jsx(j,{children:a.jsxs(R,{variant:"danger",onClose:()=>g(null),dismissible:!0,className:"mb-0",children:[a.jsx(R.Heading,{className:"fs-6",children:"Error"}),a.jsx("p",{className:"mb-0 small",children:C})]})})}),a.jsx(N,{children:a.jsx(j,{children:a.jsx(F,{className:"border-0 shadow-sm",children:a.jsx(F.Body,{className:"p-0",style:{height:"calc(100vh - 350px)"},children:p?a.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[a.jsx(L,{animation:"border",variant:"primary",style:{width:"3rem",height:"3rem"}}),a.jsx("p",{className:"mt-3 text-muted",children:"Generating forwarding letter..."}),a.jsx("small",{className:"text-muted",children:"This may take a few moments"})]}):D&&w?a.jsx(ue,{pdfBase64:w,title:`Forwarding Letter - ${A}`}):a.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[a.jsx(te,{size:64,className:"text-muted mb-3 opacity-50"}),a.jsx("h5",{className:"text-muted mb-2",children:"No PDF Available"}),a.jsx("p",{className:"text-muted small text-center px-4",children:l?.value==="all"?"Select 'All Institutions' to generate a combined forwarding letter":"Please select an institution to generate its forwarding letter"})]})})})})})]}),a.jsx("style",{children:`
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    .spin {
                        animation: spin 1s linear infinite;
                    }
                `})]})};export{Ee as default};
