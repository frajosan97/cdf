import{r as u,j as r,R as v,b as U,H as W,c as P}from"./app-BDdR8tlL.js";import{A as V,B as G}from"./AuthenticatedLayout-C3TfAMOg.js";import{S as q}from"./react-select.esm-pKErPcHq.js";import{u as J,c as K,P as m,C as Q,B as $}from"./ApplicationLogo-Ct94hGqC.js";import{R as N,C as j,a as C}from"./Row-8B2WQNFF.js";import{B as X,D as Y,F as Z}from"./file-earmark-pdf-BnpaS6oS.js";import{F as ee}from"./Form-CkKKQG-5.js";import{A as F}from"./Alert-D2NsIJyT.js";import"./createLucideIcon-D8spSUSA.js";import"./CloseButton-ByA966yN.js";import"./warning-Dkzfv9EX.js";import"./InputGroupContext-B2VXgMWZ.js";const R=u.forwardRef(({bsPrefix:e,variant:n,animation:t="border",size:s,as:o="div",className:c,...f},d)=>{e=J(e,"spinner");const l=`${e}-${t}`;return r.jsx(o,{ref:d,...f,className:K(c,l,s&&`${l}-${s}`,n&&`text-${n}`)})});R.displayName="Spinner";var te=["color","size","title","className"];function O(){return O=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},O.apply(null,arguments)}function re(e,n){if(e==null)return{};var t,s,o=se(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(s=0;s<c.length;s++)t=c[s],n.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function se(e,n){if(e==null)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(n.indexOf(s)!==-1)continue;t[s]=e[s]}return t}var L=u.forwardRef(function(e,n){var t=e.color,s=t===void 0?"currentColor":t,o=e.size,c=o===void 0?"1em":o,f=e.title,d=f===void 0?null:f,l=e.className,w=l===void 0?"":l,p=re(e,te);return v.createElement("svg",O({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:c,height:c,fill:s,className:["bi","bi-arrow-repeat",w].filter(Boolean).join(" ")},p),d?v.createElement("title",null,d):null,v.createElement("path",{d:"M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9"}),v.createElement("path",{fillRule:"evenodd",d:"M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z"}))});L.propTypes={color:m.string,size:m.oneOfType([m.string,m.number]),title:m.string,className:m.string};var ae=["color","size","title","className"];function z(){return z=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},z.apply(null,arguments)}function ne(e,n){if(e==null)return{};var t,s,o=le(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(s=0;s<c.length;s++)t=c[s],n.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function le(e,n){if(e==null)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(n.indexOf(s)!==-1)continue;t[s]=e[s]}return t}var I=u.forwardRef(function(e,n){var t=e.color,s=t===void 0?"currentColor":t,o=e.size,c=o===void 0?"1em":o,f=e.title,d=f===void 0?null:f,l=e.className,w=l===void 0?"":l,p=ne(e,ae);return v.createElement("svg",z({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:c,height:c,fill:s,className:["bi","bi-printer",w].filter(Boolean).join(" ")},p),d?v.createElement("title",null,d):null,v.createElement("path",{d:"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"}),v.createElement("path",{d:"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1"}))});I.propTypes={color:m.string,size:m.oneOfType([m.string,m.number]),title:m.string,className:m.string};const ie=({pdfBase64:e,title:n="Document"})=>{const t=u.useRef(null);return u.useEffect(()=>{if(t.current&&e){const s=atob(e),o=new Array(s.length);for(let l=0;l<s.length;l++)o[l]=s.charCodeAt(l);const c=new Uint8Array(o),f=new Blob([c],{type:"application/pdf"}),d=URL.createObjectURL(f);return t.current.src=d,()=>URL.revokeObjectURL(d)}},[e]),r.jsx("iframe",{ref:t,title:n,style:{width:"100%",height:"400px",border:"none"}})},we=({data:e,pdf:n,institutions:t,approvedApplicants:s,groupedApplicants:o})=>{const{params:c}=U().props,d=new URLSearchParams(window.location.search).get("institution_id")||"all",[l,w]=u.useState(()=>d!=="all"?{value:d,label:t?.find(a=>a.id==d)?.name||"All Institutions"}:{value:"all",label:"All Institutions"}),[p,x]=u.useState(!1),[b,S]=u.useState(n),[D,y]=u.useState(!0),[E,h]=u.useState(null),k=u.useMemo(()=>[{value:"all",label:"All Institutions"},...t?.map(i=>({value:i.id.toString(),label:`${i.name} (${i.code})`,institution:i}))||[]],[t]);u.useEffect(()=>{if(e?.type==="single"&&e?.institutions?.[0]){const a=e.institutions[0];w({value:a.id.toString(),label:`${a.name} (${a.code})`})}},[e]),u.useEffect(()=>{n&&(S(n),y(!0),h(null))},[n]);const B=a=>{if(!a)return;w(a),x(!0),y(!1),h(null);const i=a.value;i==="all"?P.get(route("reports.forwarding.letter"),{},{preserveState:!0,preserveScroll:!0,onSuccess:g=>{S(g.props.pdf),y(!0),x(!1)},onError:g=>{h(g.message||"Failed to load forwarding letter"),x(!1)}}):P.get(route("reports.institution.forwarding.letter",i),{},{preserveState:!0,preserveScroll:!0,onSuccess:g=>{S(g.props.pdf),y(!0),x(!1)},onError:g=>{h(g.message||"Failed to load forwarding letter"),x(!1)}})},M=()=>{if(b){const a=l?.value==="all"?"all-institutions":t?.find(g=>g.id.toString()===l.value)?.name?.replace(/\s+/g,"-").toLowerCase()||"forwarding-letter",i=document.createElement("a");i.href=`data:application/pdf;base64,${b}`,i.download=`forwarding-letter-${a}-${new Date().toISOString().split("T")[0]}.pdf`,i.click()}},_=()=>{if(b){const a=window.open("","_blank");if(!a){h("Popup blocked. Please allow popups for this site.");return}a.document.write(`
                <html>
                    <head>
                        <title>Forwarding Letter - ${l?.label||"NG-CDF"}</title>
                        <style>
                            body, html { margin: 0; padding: 0; height: 100%; }
                            embed { width: 100%; height: 100%; }
                        </style>
                    </head>
                    <body>
                        <embed src="data:application/pdf;base64,${b}" type="application/pdf" width="100%" height="100%" />
                    </body>
                </html>
            `),a.document.close(),setTimeout(()=>{try{a.focus(),a.print()}catch{h("Unable to print. Please try downloading first.")}},1e3)}},H=()=>{x(!0),h(null),P.reload({onSuccess:()=>{x(!1)},onError:a=>{h(a.message||"Failed to refresh"),x(!1)}})},A=u.useMemo(()=>{if(l?.value==="all")return"All Institutions";const a=t?.find(i=>i.id.toString()===l?.value);return a?`${a.name} (${a.code})`:"Select Institution"},[l,t]),T={control:(a,i)=>({...a,minHeight:"45px",border:i.isFocused?"2px solid #0d6efd":"1px solid #dee2e6",boxShadow:"none","&:hover":{borderColor:"#0d6efd"}}),option:(a,i)=>({...a,backgroundColor:i.isSelected?"#0d6efd":i.isFocused?"#e7f1ff":"white",color:i.isSelected?"white":"black",cursor:"pointer",padding:"10px 12px"}),menu:a=>({...a,zIndex:9999}),placeholder:a=>({...a,color:"#6c757d"}),singleValue:a=>({...a,fontWeight:"500"})};return r.jsxs(V,{children:[r.jsx(W,{title:"Forwarding Letter"}),r.jsxs(Q,{fluid:!0,children:[r.jsxs(N,{className:"mb-4 align-items-center",children:[r.jsxs(j,{children:[r.jsx("h3",{className:"mb-0",children:"Forwarding Letter"}),r.jsx("small",{className:"text-muted",children:"Generate and manage bursary forwarding letters"})]}),r.jsx(j,{xs:"auto",children:r.jsxs(G,{bg:"info",className:"p-2",children:[r.jsx(X,{className:"me-1",size:14}),A]})})]}),r.jsxs(N,{className:"mb-4 g-3",children:[r.jsxs(j,{md:6,lg:7,children:[r.jsx(q,{options:k,value:l,onChange:B,isDisabled:p,placeholder:"Search institution...",className:"react-select-container",classNamePrefix:"react-select",styles:T,isClearable:!1,isSearchable:!0,loadingMessage:()=>"Loading institutions...",noOptionsMessage:()=>"No institutions found"}),r.jsx(ee.Text,{className:"text-muted",children:"Select an institution to generate its forwarding letter"})]}),r.jsx(j,{md:6,lg:5,children:r.jsxs("div",{className:"d-flex gap-2 justify-content-md-end",children:[r.jsxs($,{variant:"outline-secondary",size:"sm",onClick:H,disabled:p,className:"d-flex align-items-center gap-2",children:[r.jsx(L,{size:16,className:p?"spin":""}),"Refresh"]}),r.jsxs($,{variant:"primary",size:"sm",onClick:_,disabled:!b||p,className:"d-flex align-items-center gap-2",children:[r.jsx(I,{size:16}),"Print"]}),r.jsxs($,{variant:"success",size:"sm",onClick:M,disabled:!b||p,className:"d-flex align-items-center gap-2",children:[r.jsx(Y,{size:16}),"Download PDF"]})]})})]}),E&&r.jsx(N,{className:"mb-4",children:r.jsx(j,{children:r.jsxs(F,{variant:"danger",onClose:()=>h(null),dismissible:!0,className:"mb-0",children:[r.jsx(F.Heading,{className:"fs-6",children:"Error"}),r.jsx("p",{className:"mb-0 small",children:E})]})})}),r.jsx(N,{children:r.jsx(j,{children:r.jsx(C,{className:"border-0 shadow-sm",children:r.jsx(C.Body,{className:"p-0",style:{height:"calc(100vh - 350px)"},children:p?r.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[r.jsx(R,{animation:"border",variant:"primary",style:{width:"3rem",height:"3rem"}}),r.jsx("p",{className:"mt-3 text-muted",children:"Generating forwarding letter..."}),r.jsx("small",{className:"text-muted",children:"This may take a few moments"})]}):D&&b?r.jsx(ie,{pdfBase64:b,title:`Forwarding Letter - ${A}`}):r.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100",children:[r.jsx(Z,{size:64,className:"text-muted mb-3 opacity-50"}),r.jsx("h5",{className:"text-muted mb-2",children:"No PDF Available"}),r.jsx("p",{className:"text-muted small text-center px-4",children:l?.value==="all"?"Select 'All Institutions' to generate a combined forwarding letter":"Please select an institution to generate its forwarding letter"})]})})})})})]}),r.jsx("style",{children:`
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    .spin {
                        animation: spin 1s linear infinite;
                    }
                `})]})};export{we as default};
